function [z,p]=geweke(chain,a,b)
%GEWEKE Geweke's MCMC convergence diagnostic
% [z,p] = geweke(chain,a,b)
% Test for equality of the means of the first a% (default 10%) and
% last b% (50%) of a Markov chain.
% See:
% Stephen P. Brooks and Gareth O. Roberts.
% Assessing convergence of Markov chain Monte Carlo algorithms.
% Statistics and Computing, 8:319--335, 1998.

% ML, 2002
% $Revision: 1.3 $  $Date: 2003/05/07 12:22:19 $

[nsimu,npar]=size(chain);

if nargin<3
    a = 0.1;
    b = 0.5;
end

na = floor(a*nsimu);
nb = nsimu-floor(b*nsimu)+1;

if (na+nb)/nsimu >= 1
    error('Error with na and nb');
end

m1 = mean(chain(1:na,:));
m2 = mean(chain(nb:end,:));

%%% Spectral estimates for variance
sa = spectrum0(chain(1:na,:));
sb = spectrum0(chain(nb:end,:));

z = (m1-m2)./(sqrt(sa/na+sb/(nsimu-nb+1)));
p = 2*(1-nordf(abs(z)));
% p-value: kleinstes (marginales) Signifikanzlevel, auf dem wir die
% Nullhypothese H0 verwerfen können. Er ist die Wahrscheinlichkeit, dass
% wir einen anderen Wert z' der Teststatistik beobachten, der genauso oder
% noch extremer ist, als der, den wir beobachtet haben z. (Unter der
% Annahme, dass H0 gilt.) In der Praxis verwerfen wir H0 auf dem
% Signifikanzlevel alpha, sofern der p-value kleiner als alpha ist.
% nordf(z) = cdf of stdnormal(z) = wie viel prozent der werte sind kleiner als z. 
% -> 1-nordf(z) = wie viel prozent sind grosser als z.
% -> (normalvert. symmetr -> 2*(.) -> zweiseitiger T Test ) 
% p = wie viel prozent der Werte sind kleiner oder grosser als z / extremer
% als z. Wenn p<0.05, dann konnen wir die Nullhypothes H0 (Mittelwerte sind
% gleich) auf dem 95% Level verwerfen.
end
